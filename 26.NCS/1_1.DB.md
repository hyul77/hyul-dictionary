# 1_1.DB

## DB
### DataBase
- 공동으로 사용될 데이터를 중복을 배제하여 통합하고 저장장치에 저장하여 항상 사용할 수 있도록 운영하는 운영데이터
- 통합된 데이터 : 자료의 중복을 배제한 데이터의 모임
- 저장된 데이터 : 컴퓨터가 접근할 수 있는 저장 매체에 저장된 자료
- 운영 데이터 : 조직의 고유한 업무를 수행하는데 반드시 필요한 자료
- 공용 데이터 : 여러 응용 시스템들이 공동으로 소유하고 유지하는 자료

### DB 관리시스템(DBMS)
- 사용자와 DB 사이에서 정보를 생성, 관리 해주는 SW
- 요구사항 식별시 고려 (가용성, 성능, 기술지원, 상호호환성, 구축 비용)
- DBMS 필수 기능 3가지 (정의기능, 조작기능, 제어기능)

### DB 설계 순서
- 요구조건분석 -> 개념적 설계 -> 논리적 설계 -> 물리적 설계 -> 구현

### 개념적 설계
- 현실세계에 대한 것을 추상적 개념으로 표현한 것
- 개념 스키마 모델링과 트랜잭션 모델링을 병행 수행
- E-R 다이어그램 작성

### 논리적 설계
- 현실 세계에서 발생하는 자료를 물리적 저장 장치에 저장할 수 있도록 변환 시키는 과정
- 개념 스키마를 평가 및 정제하고 서로 다른 논리적 스키마를 설계

### 물리적 설계
- 논리적 구조로 표현된 데이터를 디스크 등의 물리적 저장장치에 저장할 수 있도록 물리적 구조의 데이터로 변환
- 저장 레코드의 형식, 순서, 접근 경로, 조회 집중 레코드 등의 정보를 사용

### 스키마
- DB의 구조와 제약조건에 관한 전반적인 명세
- 외부 스키마 : 사용자나 응용 프로그래머가 각 개인의 입장에서 필요한 DB의 논리적 구조 정의함
- 개념 스키마 : DB의 전체적 논리적 구조, 하나만 존재
- 내부 스키마 : 물리적 저장장치의 입장에서 본 DB 구조, 내부 레코드의 물리적 순서등을 나타냄

### 데이터 모델
- 현실 세계 정보를 단순화, 추상화하여 체계적으로 표현한 개념적 모형
- 표시할 요소(구조, 연산, 제약조건)

### 개체
- DB에 표현하려는 것, 사람이 생각하는 개념이나 정보 단위 같은 현실 세계의 대상체
- 독립적으로 존재하거나 그 자체로 구별이 가능하며 유일한 식별자에 의해 식별

### 관계
- 개체와 개체 사이의 논리적인 연결 의미
- 일대일, 일대다, 다대다

### E-R 모델
- 객체-관계 모델로 현실세계의 무질서한 데이터를 개념적인 논리 데이터로 표현
- 피터 첸에 의해 제안됨

### E-R 다이어그램
- 사각형:개체, 마름모:관계, 타원:속성, 이중타원:다중값속성, 밑줄타원:기본키, 복수타원:복합속성, 관계:대응수, 선,링크:개체 타입 속성연결

### 관계형 DB의 릴레이션 구조
- 릴레이션은 데이터들을 표의 형태로 표현 스키마와 인스턴스로 구성

### 튜플
- 릴레이션을 구성하는 각각의 행 의미
- 속성의 모임
- 튜플의 수 = 카디널리티, 기수, 대응수

### 속성 
- 가장 작은 논리적 단위, 개체의 특성을 기술
- 속성의 수 = 디그리, 차수

### 도메인
- 하나의 속성이 취할 수 있는 같은 타입의 원자값들의 집합

### 기본키
- 후보키 중에서 특별히 선정된 주키
- 중복값 X, NULL값 X, 유일하게 구별할 수 있는 속성

### 후보키
- 릴레이션을 구성하는 속성들 중 튜플을 유일하게 식별하기 위해 사용하는 속성의 부분집합
- 기본키로 사용할 수 있는 속성들
- 유일성, 최소성 만족

### 대체키(보조키)
- 후보키가 둘 이상일 때 기본키를 제외한 나머지 후보키

### 슈퍼키
- 속성들의 집합으로 구성된 키
- 유일성은 만족하지만 최소성은 만족하지 못함

### 외래키
- 다른 릴레이션의 기본키를 참조하는 속성 또는 속성들의 집합

### 무결성
- DB에 저장된 데이터 값과 실제값이 일치하는 정확성
- 개체 무결성 : 기본 테이블의 기본키를 구성하는 어떤 속서어도 NULL값이나 중복값을 가질 수 없음
- 참조 무결성 : 외래키 값은 NULL이거나 차조 릴레이션의 기본키 값과 동일해야함

### 관계대수
- 원하는 정보와 그 정보를 검색하기 위해서 어떻게 유도하는가를 기술하는 절차적인 언어
- 연산자와 연산규칙을 제공하며, 피연산자와 연산 결과가 모두 릴레이션

### 순수 관계 연산자
- Select, Project, Join, Division

### 일반 집합 연산자
- 합집합, 교집합, 차집합, 교차곱

### 관계해석
- 관계 데이터의 연산을 표현하는 방법
- 원하는 정보가 무엇이라는 것만 정의하는 비절차적 특성을 지님

### 이상
- 데이터들이 불필요하게 중복되어 릴레이션 조작 시 예기치 않게 발생하는 곤란한 현상
- 삽입 이상 : 의도와 상관없이 원하지 않는 값들로 인해 삽입할 수 없게 되는 현상
- 삭제 이상 : 의도와 상관없는 값들도 함꼐 삭제되는 연쇄 삭제 발생하는 현상
- 갱신 이상 : 일부 튜플의 정보만 갱신되어 정보에 불일치성이 생기는 현상

### 함수적 종속
- 함수적 종속 : X->Y
- 완전 함수적 종속 : ZㄷX
- 부분 함수적 종속 : Y가 다른 속성 집합 X 전체에 대해 함수적 종속이면서 X의 임의의 진부분 집합에 대해 함수적 종속일 때

### 정규화
- 테이블의 속성들이 상호 종속적인 관계를 갖는 특성을 이용해 테이블을 무손실 분해하는 과정
- 목적은 중복을제거하여 이상의 발생 가능성을 줄이는 것

### 정규화 과정
- 제 1정규형(1NF) : 모든 속성 도메인이 원자값(리스트 형태 삭제)
- 제 2정규형(2NF) : 기본키가 아닌 모든 속성이 기본키에 대하여 완전 함수적 종속을 만족
- 제 3정규형(3NF) : 모든 속성이 기본키에 대해 이행적 함수적 종속을 만족하지않는 정규형
- BCNF : 모든 결정자가 후보키
- 제 4정규형(4NF) : 다중값 종속 존재할 경우 R의 모든 속성이 함수적 종속 관계를 만족
- 제 5정규형(5NF) : 모든 조인 종속이 후보키를 통해서만 성립

### 정규화 과정 정리
- 도메인이 원자값
- 부분적 함수 종속 제거
- 이행적 함수 종속 제거
- 결정자이면서 후보키가 아닌 것 제거
- 다치 종속 제거
- 조인 종속성 이용

### 반정규화
- 시스템의 선응을 향상 및 운영의 편의성을 높이기 위해 정규화 된 데이터 모델을 의도적으로 통합, 중복, 분리해 정규화 원칙을 위배

### 중복 테이블 추가
- 작업의 효율성을 향상시키기 위해 테이블을 추가
- 집계 테이블, 진행 테이블, 특정 부분만 포함하는 테이블의 추가

### 시스템 카탈로그
- 다양한 객체에 관한 정보를 포함하는 시스템 데이터베이스
- 데이터 사전에 저장되어 좁은 의미로는 카탈로그를 데이터 사전이라고도 함

### 트랜잭션
- 하나의 논리적 기능을 수행하기 위한 작업의 단위 또는 한꺼번에 모두 수행되어야 할 일련의 연산들
- 사용자 요구시 시스템이 응답하기 위한 상태 변환 과정의 작업 단위

### 트랜잭션 특성
- 원자성 : 모두 반영되도록 완료 되든지 아니면 전혀 반영되지 않도록 복구 되어야함
- 일관성 : 언제나 일관성 있는 DB 상태로 변환함
- 독립성, 격리성 : 둘 이상의 트랜잭션이 동시에 병행되는 경우 다른 트랜잭션의 연산에 끼어들 수 없음
- 영구성, 지속성 : 성공적으로 완료된 트랜잭션의 결과는 시스템이 고장나도 영구적으로 반영되어야함

### CRUD 분석
- 프로세스와 테이블간의 CRUD매트릭스를 만들어 트랜잭션을 분석
- 생성, 읽기, 갱신, 삭제 연산으로 분석

### 인덱스
- 데이터 레코드를 빠르게 접근하기 위해 <키, 포인터> 쌍으로 구성

### 클러스터드/넌클러스터드 인덱스
- 클러스터 인덱스: 인덱스 키의 순서에 따라 데이터가 정렬되어 저장되는 방식, 인덱스를 검색하지 않아도 원하는 데이터를 빠르게 찾을 수 있음
- 넌클러스터 인덱스 : 인덱스 키 값만 정렬되어 있고 실제 데이터는 정렬 되어있지 않음, 삽입 삭제 시 순서 유지하기 위해 데이터 재정렬 필요

### View
- 사용자에게 접근이 허용된 자료만을 제한적으로 보여주기 위해 하나이상의 기본 테이블로부터 유도된 가상 테이블
- Create, Drop

### 파티션
- 대용량의 테이블이나 인덱스를 작은 논리적 단위인 파티션으로 나눔
- 성능저하 방지, 관리 용이
- 데이터 처리는 테이블 단위, 저장은 파티션별 수행

### 파티션의 종류
- 범위 분할 : 지정한 열의 값을 기준
- 해시 분할 : 해시함수 적용한 결과 값에 따라 데이터 분할, 주민번호등과 같은 고른 컬럼에 효과적
- 조합 분할 : 범위 분할로 분할한 다음 해시 함수 적용, 범위 분할한 파티션이 너무 커 관리 어려울 때

### 분산 데이터베이스의 목표
- 위치 투명성 : DB의 논리적인 명칭만으로 접근 가능
- 중복 투명성 : 동일 데이터가 여러 곳에 중복 되어있어도 사용자는 하나의 데이터만 존재하는 것 처럼 사용
- 병행 투명성 : 분산 DB와 관련된 다수의 트랜잭션들이 동시에 실현되어도 영향이 없음
- 장애 투명성 : 트랜잭션, DBMS, 네트워크, 컴퓨터 장애에도 트랜잭션을 정확하게 처리함
## DDl
### DDL
- DB 구조, 데이터 형식, 접근방식 등 DB를구축하거나 수정할 목적으로 사용
- CREATE, ALTER, DROP

### CREATE DOMAIN
- 도메인을 정의
- create domain sex char(1) default '남' constraint valid-sex check(value in ('남', '여'));

### CREATE TABLE
- 테이블을 정의
- create table 학생 (이름 varchar(15) not null, 학번 char(8), ... primary key(학번), foreign key(전공) references 학과(학과코드) on delete set null on update cascade, constraint 생년월일제약 check(생년월일>='1980-01-01'));
- cascade : 변경되면 같은 값으로 변경

### CREATE VIEW
- 뷰를 정의
- create view 안산고객(성명, 전화번호) as select 성명, 전화번호 from 고객 where 주소 = '안산시';

### CREATE INDEX
- 인덱스를 정의
- create unique index 고객번호_idx on 고객(고객번호 DESC);

### ALTER TABLE
- 테이블에 대한 정의를 변경
- alter table 학생 add 학년 varchar(3);
- alter table 학생 alter 학번 varchar(10) not null;
- alter table 학생 drop column 학년;

### DROP
- 스키마, 도메인, 시본 테이블, 뷰테이블, 인덱스, 제약조건 등을 제거
- drop schema 스키마명 cascade;
- drop domain 도메인명 cascade;
- drop table 테이블명 restrict;

## DCL
### DCL
- 데이터의 보안, 무결성, 회복, 병행 제어 등을 정의
- COMMIT, ROLLBACK, GRANT, REVOKE

### GRANT / REVOKE
- GRANT : 권한 부여
- REVOKE : 권한 취소
- GRANT 권한_리스트 ON 개체 TO 사용자 [WITH GRANT OPTION];
- REVOKE [GRANT OPTION FOR] 권한_리스트 ON 개체 FROM 사용자 [CSCADE];
- 권한 종류 : ALL, SELECT, INSERT, DELETE, UPDATE
- with grant option 부여 받은 권한을 다른 사용자에게 다시 부여할 수 있는 권한
- grant option for : 다른 사용자에게 권한을 부여할 수 있는 권한을 취소함
- cascade : 권한 취소 시 권한을 부여 받았던 사용자가 다른 사용자에게 부여한 권한도 연쇄적으로 취소

### ROLLBACK
- 변경되었으나 아직 commit이 안된 모든 내용들을 취소하고 이전 상태로 되돌리는 명령어
- 트랜잭션 전체가 성공적으로 끝내지 못하면 비일관성 상태가 되기에 롤백되어야함

### SAVEPOINT
- 트랜잭션 내에 Rollback할 위치인 저장점을 지정하는 명령어
- 저장점을 지정할 때는 이름을 부여
- Rollback할 때 저장점까지의 트랜잭션 처리 내용이 모두 취소

## DML
### DML
- DB 사용자가 저장된 Data를 실질적으로 관리하는데 사용되는 언어
- DML은 사용자와 관리 시스템간의 인터페이스를 제공
- SELECT, INSERT, DELETE, UPDATE

### INSERT INTO
- insert into 사원(이름, 부서) values('홍승현', '인터넷');

### 삭제문(DELETE FROM ~)
- delete from 사원 where 이름 = '임꺽정'

### 갱신문(UPDATE~ SET~)
- update 사원 set 주소 = '수색동' where 이름 = '홍길동'

### SELECT
- select ... from ... where ... group by ... having ... order by ...
- 전체 검색 : select * from 사원;
- 중복 제거 : select distinct 주소 from 사원;
- 조건 검색 : select * from 사원 where 부서 = '기획';
- 다중 조건 검색 : select * from 사원 where 부서='기획' and 주소='대흥동';
- like 조건 검색 : select * from 사원 where 이름 like "김%";
- 정렬 검색 : select * from 사원 order by 부서 asc, 이름 desc;
- 하위 질의 : select 이름, 주소 from 사원 where 이름 = (select 이름 from 여가활동 where 취미 = '나이트댄스');
- 반대 하위 질의 : select * from 사원 where 이름 not in (select 이름 from 여가활동);
- 그룹 함수 : select count(*) from 사원 where empno > 100 and sal >= 3000 or empno = 200;
- count(속성명), sum(속성명), avg(속성명), max(속성명), min(속성명), stddev(속성명), variance(속성명)
- 그룹 지정 검색 : select 부서, avg(상여금) as 평균 from 상여금 group by 부서;
- 그룹 지정 조건 검색 : select 부서 count(*) as 사원수 from 상여금 where 상여금 >=100 group by 부서 having count(*)>=2;

### 집합 연산자를 이용한 통합 질의
- UNION(합집합) : 두 select 문의 조회 결과를 통합하여 모두 출력함, 중복된 행은 한번만 출력
- UNION ALL(합집합) : 두 select문의 조회 결과를 통합하여 모두 출력함, 중복된 행도 그대로 출력
- INTERSECT : 두 select문의 조회 결과 중 공통된 행만 출력함
- EXCEPT : 첫번째 select문의 조회 결과에서 두번째 select 문의 조회 결과를 제외한 행을 출력

### JOIN
- 2개의 릴레이션에서 연관된 튜플들을 결합하여, 하나의 새로운 릴레이션을 반환
- 보통 from문에 기술하지만 릴레이션이 사용되는 곳 어디서나 사용할 수 있음
- INNER JOIN, OUTER JOIN으로 구분

### EQUI JOIN
- 공통 속성을 기준으로 '='(equal)비교에 의해 같은 값을 가지는 행을 연결하여 결과를 생성하는 INNER JOIN 방법
- 중복된 속성을 제거하여 같은 속성을 한번만 표기하는 방법을 NATURAL JOIN이라함
- EQUI JOIN : select t1.속성, t2.속성 from t1, t2 where t1.속성명 = t2.속성명;
- NATUREAL JOIN : select t1.속성, t2.속성 from t1 NATURAL JOIN t2;
- JOIN USING : select t1.속성, t2.속성 from t1 JOIN t2 USING(속성명);

### OUTER JOIN
- LEFT OUTER JOIN : 우측항 릴레이션의 어떤 튜플과도 맞지 않는 좌측 항의 릴레이션에 있는 튜플들에 NULL 값 붙여서 추가
- SELECT t1.속성, t2.속성 from t1 LEFT OUTER JOIN t2 ON t1.속성명 = t2.속성명;
- RIGHT OUTER JOIN : 좌측 항 릴레이션의 어떤 튜플과도 맞지 않는 우측항의 릴레이션에 있는 튜플들에 NULL 값을 붙여서 추가
- SELECT t1.속성, t2.속성 from t1 RIGHT OUTER JOIN t2 ON t1.속성명 = t2.속성명;

### 트리거
- 삽입, 갱신, 삭제 등의 이벤트가 발생할 때 관련 작업이 자동으로 수행되게 하는 절차형 SQL
- 트리거는 DB에 저장, 데이터 변경 및 무결성 유지, 로그 메시지 출력 등의 목적으로 사용

### 커서
- 쿼리문의 처리 결과가 저장되어 있는 메모리 공간을 가리키는 포인터
- 묵시적 커서 : DBMS에 의해 내부에서 자동으로 생성되어 사용되는 커서
- 명시적 커서 : 사용자가 직접 정의해서 사용하는 커서
- 커서의 속성을 조회하여 사용된 쿼리 정보를 열람하는 것 가능
- SQL%FOUND : 쿼리 수행의 결과로 패치된 튜플 수가 1개 이상이면 TRUE
- SQL%NOTFOUND : 쿼리 수행의 결과로 패치된 튜플 수가 0개면 TRUE
- SQL%ROWCOUNT : 쿼리 수행의 결과로 패치된 튜플 수를 반환
- SQL%ISOPEN : 커서가 열린 상태면 TRUE, 묵시적 커서는 자동으로 생성된 후 자동으로 닫혀서 항상 FALSE

### DBMS 접속 기술의 종류
- DBMS에 접근하기 위해 사용하는 API 또는 API의 사용을 편리하게 도와주는 프레임워크
- JDBC : Java언어로 접속할 때 사용 표준 API
- ODBC : 개발 언어에 관계 없이 접근을 위한 표준 개방형 API
- MyBatis : JDBC코드를 단순화하여 사용할 수 있는 SQL Mapping 기반 오픈 소스 접속 프레임워크

### 동적 SQL
- SQL 구문을 동적으로 변경하여 처리할 수 있는 SQL 처리 방식
- 속도가 느리지만 상황에 따라 다양한 조건을 첨가하는 등 유연한 개발 가능

### ORM
- 객체지향 프로그래밍의 객체와 관계형 DB의 데이터를 연결하는 기술
- Java : JPA, Hibernate, EclipseLink
- C++ : ODB, QxOrm
- Python : Django, SQLAIchemy, Storm
- .NET : NHibernate, DatabaseObjects, Dapper
- PHP : Doctrine, Propel, RedBean

### 쿼리 성능 관련 용어
- APM : 성능 관리를 위해 접속자, 자원 현황, 트랜잭션 수행 내역, 장애진단 등의 다양한 모니터링 기능을 제공
- 옵티마이저 : 작성된 SQL이 가장 효율적으로 수행되도록 최적의 경로를 찾아주는 모듈
- 실행 계획 : DBMS의 옵티마이저가 수립한 SQL 코드의 실행 절차와 방법임
- 힌트 : 테이블 접근 순서를 변경하거나 인덱스 사용을 강제하는 등의 실행 계획에 영향을 줄 수 있는 문장
- IOT : 인덱스 안에 테이블 데이터를 직접 삽입하여 저장함으로써 주소를 얻는 과정을 생략하여 빠른 조회 가능